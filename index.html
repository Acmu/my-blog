<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>MingYuan&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="明远博客 MingYuan&#39;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="MingYuan&#39;s Blog">
<meta property="og:url" content="https://acmu.github.io/index.html">
<meta property="og:site_name" content="MingYuan&#39;s Blog">
<meta property="og:description" content="明远博客 MingYuan&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MingYuan">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/my-blog/atom.xml" title="MingYuan's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/my-blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/my-blog/css/style.css">

  
    
<link rel="stylesheet" href="/my-blog/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/my-blog/" id="logo">MingYuan&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/my-blog/" id="subtitle">明远博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/my-blog/">Home</a>
        
          <a class="main-nav-link" href="/my-blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/my-blog/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://acmu.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-JavaScript/js-promise" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/17/JavaScript/js-promise/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T22:52:20.000Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/17/JavaScript/js-promise/">JavaScript 异步与 Promise</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="异步是什么？"><a href="#异步是什么？" class="headerlink" title="异步是什么？"></a>异步是什么？</h2><p>异步是相对于同步而言的，那同步是什么呢？简单说就是干完a事情，之后再干b事情，这挺正常的，人的思维都是这样做事的，那为什么还需要异步呢？举个现实中的例子，比如你已经下单定了外卖，你会什么也不干，一直等到外卖到了之后再做事情吗？显然不会的，你会在外卖到了之前做一些与吃外卖无关的事情，比如看书、刷剧啥的，之后外卖到了，再去吃外卖。</p>
<h2 id="异步解决什么问题？"><a href="#异步解决什么问题？" class="headerlink" title="异步解决什么问题？"></a>异步解决什么问题？</h2><p>更快的完成更多的任务</p>
<p>多线程也能更快的完成任务，但这种方式要比异步更复杂，因为会引发多个线程同时更改数据的问题，就需要加锁来解决</p>
<h2 id="JS中的异步"><a href="#JS中的异步" class="headerlink" title="JS中的异步"></a>JS中的异步</h2><h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><p>那如何实现异步呢？JS中首先使用了回调函数的方式，此方式可以理解为我在下单外卖后，定了一个todo列表（如其中有：取外卖、吃饭、扔垃圾等），之后我就去干其他的事情了，但我的耳朵会一直监听手机铃声，如果铃声响了，并且我也是空闲的状态下，就会去执行todo列表（也就是回调函数），但我如果有其他事情（比如在上厕所），那么就会做完其他事情之后再去执行todo列表。</p>
<p>回到代码，我们知道回调函数会引起回调地狱的问题，所以在写法、可读与维护上都不太好</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><p>增加了错误处理，内置实现了 Promise.all race 等操作，对于串行请求操作更方便了，回调需要更深层的缩进来实现串行请求，而Promise是在同一层级的链式调用，在下面写代码就行了，而不需要在里面。</p>
<p>Promise的问题是太多模板代码了，写上去一堆then。</p>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><p>利用了协程的机制，使代码可以执行到一半时，把控制权交给其他函数，之后还可以再拿回来。并且使用回调函数或Promise可以交还执行权，实现自动执行。</p>
<h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><p>async函数是Generator的语法糖，它内置的执行器，并且有更好的语义。</p>
<h2 id="实现自己的-Promise"><a href="#实现自己的-Promise" class="headerlink" title="实现自己的 Promise"></a>实现自己的 Promise</h2><h3 id="分析基本"><a href="#分析基本" class="headerlink" title="分析基本"></a>分析基本</h3><p>可以先写一个简单的实现，同步版本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise 实现（同步版本）</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    executor(<span class="built_in">this</span>.resolve, <span class="built_in">this</span>.reject);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  status = PENDING;</span><br><span class="line"></span><br><span class="line">  value = <span class="literal">null</span>;</span><br><span class="line">  reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">      <span class="built_in">this</span>.reason = reason;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  then = <span class="function">(<span class="params">onFulfilled, onRejected</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">      onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">      onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(&#x27;success&#x27;);</span></span><br><span class="line">  reject(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(</span><br><span class="line">  <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;reject&#x27;</span>, error);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>之后再实现一个异步版本：（增加onFulfilledCallback等回调函数的存储，在then的时候如果状态是pending，那么就存下来，之后在resolve的时候再去执行）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise 实现（异步版本，可注册多个 then）</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    executor(<span class="built_in">this</span>.resolve, <span class="built_in">this</span>.reject);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  status = PENDING;</span><br><span class="line"></span><br><span class="line">  value = <span class="literal">null</span>;</span><br><span class="line">  reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  onFulfilledCallbacks = [];</span><br><span class="line">  onRejectedCallbacks = [];</span><br><span class="line"></span><br><span class="line">  resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line">      <span class="keyword">while</span> (<span class="built_in">this</span>.onFulfilledCallbacks.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledCallbacks.shift()(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">      <span class="built_in">this</span>.reason = reason;</span><br><span class="line">      <span class="keyword">while</span> (<span class="built_in">this</span>.onRejectedCallbacks.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onRejectedCallbacks.shift()(reason);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  then = <span class="function">(<span class="params">onFulfilled, onRejected</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">      onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">      onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.onFulfilledCallbacks.push(onFulfilled);</span><br><span class="line">      <span class="built_in">this</span>.onRejectedCallbacks.push(onRejected);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>最终版本：then方法的链式调用、增加错误捕获：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyPromise 实现（then链式调用）</span></span><br><span class="line"><span class="keyword">const</span> PENDING = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">executor</span>)</span> &#123;</span><br><span class="line">    executor(<span class="built_in">this</span>.resolve, <span class="built_in">this</span>.reject);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  status = PENDING;</span><br><span class="line"></span><br><span class="line">  value = <span class="literal">null</span>;</span><br><span class="line">  reason = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  onFulfilledCallbacks = [];</span><br><span class="line">  onRejectedCallbacks = [];</span><br><span class="line"></span><br><span class="line">  resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = FULFILLED;</span><br><span class="line">      <span class="built_in">this</span>.value = value;</span><br><span class="line">      <span class="keyword">while</span> (<span class="built_in">this</span>.onFulfilledCallbacks.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledCallbacks.shift()(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">      <span class="built_in">this</span>.status = REJECTED;</span><br><span class="line">      <span class="built_in">this</span>.reason = reason;</span><br><span class="line">      <span class="keyword">while</span> (<span class="built_in">this</span>.onRejectedCallbacks.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onRejectedCallbacks.shift()(reason);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  then = <span class="function">(<span class="params">onFulfilled, onRejected</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === FULFILLED) &#123;</span><br><span class="line">        <span class="keyword">const</span> x = onFulfilled(<span class="built_in">this</span>.value);</span><br><span class="line">        resolvePromise(x, resolve, reject);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === REJECTED) &#123;</span><br><span class="line">        onRejected(<span class="built_in">this</span>.reason);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.status === PENDING) &#123;</span><br><span class="line">        <span class="built_in">this</span>.onFulfilledCallbacks.push(onFulfilled);</span><br><span class="line">        <span class="built_in">this</span>.onRejectedCallbacks.push(onRejected);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> promise2;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">x, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">    x.then(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resolve(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">other</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;other&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">    <span class="keyword">return</span> other();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;resolve&#x27;</span>, value);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>在then中返回自身会产生错误，在代码中不要这样操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">100</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> p1 = promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">  <span class="keyword">return</span> p1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/js/js-async.html">https://www.runoob.com/js/js-async.html</a></li>
<li><a target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/generator-async">https://es6.ruanyifeng.com/#docs/generator-async</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6945319439772434469">https://juejin.cn/post/6945319439772434469</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/17/JavaScript/js-promise/" data-id="cl5pg3mnb000ubpord1vsfz4n" data-title="JavaScript 异步与 Promise" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JavaScript/js-regexp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/17/JavaScript/js-regexp/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T22:30:37.000Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/17/JavaScript/js-regexp/">JavaScript 正则理解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>正则表达式可以帮我们匹配字符串，大多数语言都有自己对于正则表达式的实现，这里我们看下JavaScript的实现。</p>
<h2 id="正则的标准"><a href="#正则的标准" class="headerlink" title="正则的标准"></a>正则的标准</h2><p>它由正则表达式主体和修饰符组成</p>
<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">i</td>
<td align="left">执行对大小写不敏感的匹配。</td>
</tr>
<tr>
<td align="left">g</td>
<td align="left">执行全局匹配（查找所有匹配而非在找到第一个匹配后停止）。</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">执行多行匹配。</td>
</tr>
</tbody></table>
<h3 id="正则表达式主体"><a href="#正则表达式主体" class="headerlink" title="正则表达式主体"></a>正则表达式主体</h3><p>也叫「模式」pattern</p>
<p>方括号或圆括号，匹配你想要的字符范围</p>
<table>
<thead>
<tr>
<th align="left">表达式</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[abc]</td>
<td align="left">查找方括号之间的任何字符。</td>
</tr>
<tr>
<td align="left">[^abc]</td>
<td align="left">查找任何不在方括号之间的字符。</td>
</tr>
<tr>
<td align="left">[0-9]</td>
<td align="left">查找任何从 0 至 9 的数字。</td>
</tr>
<tr>
<td align="left">[a-z]</td>
<td align="left">查找任何从小写 a 到小写 z 的字符。</td>
</tr>
<tr>
<td align="left">[A-z]</td>
<td align="left">查找任何从大写 A 到小写 z 的字符。（根据ASCII码顺序的）</td>
</tr>
<tr>
<td align="left">(red|blue|green)</td>
<td align="left">查找任何指定的选项。（非单个字符，可以是连续的）</td>
</tr>
</tbody></table>
<p>有一些字符集是很常用的，如<code>[0-9]</code>代表数字，每次都这样写就比较麻烦，所以正则提供了元字符，如下（小写代表匹配，大写代表排除）：</p>
<table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.</td>
<td align="left">查找单个字符，除了换行和行结束符。</td>
</tr>
<tr>
<td align="left">\w</td>
<td align="left">word 查找数字、大小写字母、下划线。</td>
</tr>
<tr>
<td align="left">\W</td>
<td align="left">非 word</td>
</tr>
<tr>
<td align="left">\d</td>
<td align="left">digit 查找数字</td>
</tr>
<tr>
<td align="left">\D</td>
<td align="left">非 digit</td>
</tr>
<tr>
<td align="left">\s</td>
<td align="left">whitespace 查找空白字符。</td>
</tr>
<tr>
<td align="left">\S</td>
<td align="left">非 whitespace</td>
</tr>
<tr>
<td align="left">\b</td>
<td align="left">Word boundary 匹配单词边界。</td>
</tr>
<tr>
<td align="left">\B</td>
<td align="left">非 Word boundary</td>
</tr>
<tr>
<td align="left">\0</td>
<td align="left">查找 NULL 字符。</td>
</tr>
<tr>
<td align="left">\n</td>
<td align="left">查找换行符。</td>
</tr>
<tr>
<td align="left">\f</td>
<td align="left">查找换页符。</td>
</tr>
<tr>
<td align="left">\r</td>
<td align="left">查找回车符。</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">查找制表符。</td>
</tr>
<tr>
<td align="left">\v</td>
<td align="left">查找垂直制表符。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-octal.html">\xxx</a></td>
<td align="left">查找以八进制数 xxx 规定的字符。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-hex.html">\xdd</a></td>
<td align="left">查找以十六进制数 dd 规定的字符。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-unicode-hex.html">\uxxxx</a></td>
<td align="left">查找以十六进制数 xxxx 规定的 Unicode 字符。</td>
</tr>
</tbody></table>
<p>以上元字符有些是常用字符的集合，有些是不好表示的字符的替代展示</p>
<p>上文讲的，都是对于单个字符，如果你想要这个模式出现10次，怎么办呢，难道要写10遍吗？不用那么麻烦的，只需要使用到量词即可</p>
<h3 id="量词"><a href="#量词" class="headerlink" title="量词"></a>量词</h3><table>
<thead>
<tr>
<th align="left">量词</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-onemore.html">n+</a></td>
<td align="left">匹配任何包含至少一个 n 的字符串。例如，/a+/ 匹配 “candy” 中的 “a”，”caaaaaaandy” 中所有的 “a”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-zeromore.html">n*</a></td>
<td align="left">匹配任何包含零个或多个 n 的字符串。例如，/bo*/ 匹配 “A ghost booooed” 中的 “boooo”，”A bird warbled” 中的 “b”，但是不匹配 “A goat grunted”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-zeroone.html">n?</a></td>
<td align="left">匹配任何包含零个或一个 n 的字符串。例如，/e?le?/ 匹配 “angel” 中的 “el”，”angle” 中的 “le”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-nx.html">n{X}</a></td>
<td align="left">匹配包含 X 个 n 的序列的字符串。例如，/a{2}/ 不匹配 “candy,” 中的 “a”，但是匹配 “caandy,” 中的两个 “a”，且匹配 “caaandy.” 中的前两个 “a”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-nxcomma.html">n{X,}</a></td>
<td align="left">X 是一个正整数。前面的模式 n 连续出现至少 X 次时匹配。例如，/a{2,}/ 不匹配 “candy” 中的 “a”，但是匹配 “caandy” 和 “caaaaaaandy.” 中所有的 “a”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-nxy.html">n{X,Y}</a></td>
<td align="left">X 和 Y 为正整数。前面的模式 n 连续出现至少 X 次，至多 Y 次时匹配。例如，/a{1,3}/ 不匹配 “cndy”，匹配 “candy,” 中的 “a”，”caandy,” 中的两个 “a”，匹配 “caaaaaaandy” 中的前面三个 “a”。注意，当匹配 “caaaaaaandy” 时，即使原始字符串拥有更多的 “a”，匹配项也是 “aaa”。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-ndollar.html">n$</a></td>
<td align="left">匹配任何结尾为 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-ncaret.html">^n</a></td>
<td align="left">匹配任何开头为 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-nfollow.html">?=n</a></td>
<td align="left">匹配任何其后紧接指定字符串 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-regexp-nfollow-not.html">?!n</a></td>
<td align="left">匹配任何其后没有紧接指定字符串 n 的字符串。</td>
</tr>
</tbody></table>
<p><code>+</code>是<code>&#123;1,&#125;</code>，<code>*</code>是<code>&#123;0,&#125;</code>，<code>?</code>是<code>&#123;0,1&#125;</code>，这些也只是个数范围的简写罢了</p>
<p><code>^n</code>是匹配以n开头，<code>n$</code>是匹配以n结尾</p>
<p><code>a(?=n)</code>是匹配后面为n的a字符串，<code>a(?!n)</code>反之，这个叫做先行断言（lookahead assertion）</p>
<p><code>(?&lt;=n)a</code>是匹配前面为n的a字符串，<code>(?&lt;!n)a</code>反之，这个叫做后行断言（lookbehind assertion），这种方式并不是所有浏览器都支持</p>
<p><code>^n</code>可以用后行断言表示，<code>n$</code>可以用先行断言表示，这两个也算是另一种形式的简写啦</p>
<p><strong>贪婪匹配与非贪婪匹配</strong></p>
<p><code>+</code>和<code>*</code>都是可以匹配多个的，那么他们默认是贪婪匹配，就是尽可能的多匹配内容，那么你想让他们尽可能的少匹配内容时，只要<code>+</code>和<code>*</code>的后面加上<code>?</code>即可，他们就变成了非贪匹配</p>
<h2 id="JavaScript-中的正则使用"><a href="#JavaScript-中的正则使用" class="headerlink" title="JavaScript 中的正则使用"></a>JavaScript 中的正则使用</h2><h3 id="RegExp-对象"><a href="#RegExp-对象" class="headerlink" title="RegExp 对象"></a>RegExp 对象</h3><p><strong>test 方法</strong></p>
<p>查看字符串是否符合你的正则</p>
<p><code>/\d/.test(&#39;sdfd1&#39;)</code></p>
<p><strong>toString 方法</strong></p>
<p>查看正则表示的字符串模式</p>
<p><code>new RegExp(&#39;\\d&#39;,&#39;g&#39;).toString()</code></p>
<p><strong>exec 方法</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regex1 = <span class="built_in">RegExp</span>(<span class="string">&#x27;foo*&#x27;</span>, <span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> str1 = <span class="string">&#x27;table football, foosball&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> array1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((array1 = regex1.exec(str1)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Found <span class="subst">$&#123;array1[<span class="number">0</span>]&#125;</span>. Next starts at <span class="subst">$&#123;regex1.lastIndex&#125;</span>.`</span>);</span><br><span class="line">  <span class="comment">// expected output: &quot;Found foo. Next starts at 9.&quot;</span></span><br><span class="line">  <span class="comment">// expected output: &quot;Found foo. Next starts at 19.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符串的方法"><a href="#字符串的方法" class="headerlink" title="字符串的方法"></a>字符串的方法</h3><p><strong>search 方法</strong></p>
<p><code>&#39;df1&#39;.search(/\d/)</code></p>
<p><strong>match 方法</strong></p>
<p><code>&#39;The rain in SPAIN stays mainly 3 in2 the plain1&#39;.match(/\d/g)</code> 结果是 <code>[&#39;3&#39;, &#39;2&#39;, &#39;1&#39;]</code></p>
<p><strong>replace 方法</strong></p>
<p><code>&#39;haha6 nb 345 lihai5&#39;.replace(/\d/g, &#39;zmy&#39;)</code> 结果<code>&#39;hahazmy nb zmyzmyzmy lihaizmy&#39;</code></p>
<p><strong>split 方法</strong></p>
<p><code>&#39;haha6 nb 345 lihai5&#39;.split(/\d/)</code> 结果<code>[&#39;haha&#39;, &#39; nb &#39;, &#39;&#39;, &#39;&#39;, &#39; lihai&#39;, &#39;&#39;]</code>，注意：边界内容会变成空字符串</p>
<p>在线测试工具：<a target="_blank" rel="noopener" href="https://regexr.com/">https://regexr.com/</a></p>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-obj-regexp.html">https://www.runoob.com/jsref/jsref-obj-regexp.html</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/17/JavaScript/js-regexp/" data-id="cl5pg3mnc000ybpor0y454zba" data-title="JavaScript 正则理解" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JavaScript/symbol" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/17/JavaScript/symbol/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T15:32:36.000Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/17/JavaScript/symbol/">JavaScript Symbol 解读</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>作为一名高级前端工程师，你一定见过类似这个的东西<code>Symbol.toPrimitive</code>、<code>@@toPrimitive</code>，他其实就是本文要讲的 Symbol，让我们一起了解下吧</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Symbol 是一个内置对象，构造函数（这是一个特殊的构造函数，因为他不能使用 new，只能直接调用）返回 Symbol 原始类型，用于返回一个唯一值（这个唯一值是什么并不重要，重要的是他和所有的其他值都不相等），如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="built_in">Symbol</span>(<span class="string">&#x27;desc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>就只有 a 能访问到 <code>Symbol(&#39;desc&#39;)</code>的值，就算你再定义一个相同的值，他们也是不相同的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="built_in">Symbol</span>(<span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b === a);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>可以发现 ‘desc’ 根本就没啥实际用处，确实是这样，他在这里只是起到了注释的作用</p>
<p>Symbol 的一大用处就是作为对象的 key（对象的 key 只能是 Symbol 或字符串这两种类型），它可以避免和已有的 key 或新增的 key 冲突。Symbol 上还有一些静态属性，他们被称为众所周知的（well-known）Symbol，用于在一些特殊操作时底层的调用</p>
<p>你如果想定义一个想让其他变量也能获取的 Symbol，也是可以的，要通过 <code>Symbol.for(&quot;key&quot;)</code> 静态方法，他会先在 Symbol 全局注册表上注册一个 key，然后返回，下次你在调用的时候就直接返回已有值了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在全局注册表中注册 zmy 这个 key</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;zmy&#x27;</span>);</span><br><span class="line"><span class="comment">// 在全局注册表中获取 zmy key 的值</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;zmy&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a === b);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// 还可以有 keyFor 或 description 获取对应的描述</span></span><br><span class="line"><span class="built_in">console</span>.log(a.description, <span class="built_in">Symbol</span>.keyFor(a));</span><br><span class="line"><span class="comment">// zmy zmy</span></span><br></pre></td></tr></table></figure>

<h3 id="为什么-Symbol-不能用-new-创建？"><a href="#为什么-Symbol-不能用-new-创建？" class="headerlink" title="为什么 Symbol 不能用 new 创建？"></a>为什么 Symbol 不能用 new 创建？</h3><p>我们可以用 String 类比举例一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">String</span>(<span class="number">97</span>));</span><br><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">String</span>(<span class="number">97</span>));</span><br><span class="line"><span class="comment">// object</span></span><br></pre></td></tr></table></figure>

<p>String 构造函数直接调用是为了强制转换的，new String 是为了获得 string 对象的，首先你肯定不想获得 Symbol 对象，你要的是 Symbol 原始类型，所以语言层面上 new Symbol 会报错，这是合理的，因为我们就算有了 Symbol 对象也没有用武之地，但你可以使用<code>Object(Symbol(&#39;f&#39;))</code>强制获取到对象封装的 Symbol</p>
<h2 id="well-known-Symbol"><a href="#well-known-Symbol" class="headerlink" title="well-known Symbol"></a>well-known Symbol</h2><p>把它翻译成众所周知的 Symbol 我还是觉得不太合适，因为一般开发者都不会了解这些 Symbol，所以就用英文原文吧。在 well-known Symbol 之前，都是用字符串来实现调用的，如 <code>JSON.stringify</code> 函数会调用对象的 <code>toJSON()</code>方法，String 强制转换会调用 <code>toString()</code> 方法等。可是随着操作符的逐渐增加，这样使用特殊字符串方法并不好，所以出现了常用 Symbol 来解决这个问题</p>
<p><a target="_blank" rel="noopener" href="https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-well-known-symbols">ES 标准</a> 一共定义了 13 个（标准中也定义了 @@toPrimitive 其实就是 Symbol.toPrimitive，只不过 @@toPrimitive 是在标准中描述的方式，Symbol.toPrimitive 是能在语言中实际用到的功能），下面我们看些常用的</p>
<h3 id="Symbol-toPrimitive"><a href="#Symbol-toPrimitive" class="headerlink" title="Symbol.toPrimitive"></a>Symbol.toPrimitive</h3><p>如果你想要把一个对象类型转为原始类型，那就要使用到 Symbol.toPrimitive 这个 key，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="comment">// 如果没有定义 Symbol.toPrimitive 这个 key，那么走的是默认行为</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(obj));</span><br><span class="line"><span class="comment">// [object Object]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果给对象定义了 Symbol.toPrimitive key，他的属性值是方法</span></span><br><span class="line"><span class="comment">// 那么在把对象转为原始类型的时候就会使用这个方法</span></span><br><span class="line">obj[<span class="built_in">Symbol</span>.toPrimitive] = <span class="function"><span class="keyword">function</span> (<span class="params">hint</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// hint 的取值有3种：string、number和default</span></span><br><span class="line">    <span class="keyword">if</span> (hint === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;mq&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hint === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">97</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(obj));</span><br><span class="line"><span class="comment">// mq</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(obj));</span><br><span class="line"><span class="comment">// 97</span></span><br></pre></td></tr></table></figure>

<p>当然，由于历史原因，你肯定也听说过用 toString 或 valueOf 也能实现以上逻辑，是的，但现代语法还是推荐首先使用 Symbol.toPrimitive 来解决，例子如下：</p>
<p><strong>对象转 string</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">    <span class="comment">// 1. 首先使用它</span></span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive]() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;symbol nb&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. 如果没有 @@toPrimitive 那么使用这个</span></span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;str&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 不用这个</span></span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;value of&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(a));</span><br></pre></td></tr></table></figure>

<p><strong>对象转 number</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">    <span class="comment">// 1. 首先使用它</span></span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive]() &#123;</span><br><span class="line">        <span class="comment">// 一定要返回数字类型，否则是 NaN</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">789</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. 接着是这个</span></span><br><span class="line">    <span class="function"><span class="title">valueOf</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 3. 最后这个</span></span><br><span class="line">    <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">567</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(a));</span><br></pre></td></tr></table></figure>

<p>所以这你也应该能理解为什么<code>+moment()</code>的值和 <code>moment().valueOf()</code>的值一样了吧</p>
<h3 id="Symbol-toStringTag"><a href="#Symbol-toStringTag" class="headerlink" title="Symbol.toStringTag"></a>Symbol.toStringTag</h3><p>由于 JavaScript 类型系统的混乱，你一定用过<code>Object.prototype.toString</code>来判断类型，那么 Symbol.toStringTag 就和这个函数有关</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 toString 函数可以判断出数组类型</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call([]));</span><br><span class="line"><span class="comment">// [object Array]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 那么如果你自己定义了一个校验类，想让他在 toString 时能返回特定类型该怎么办呢？</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidatorClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> ValidatorClass()));</span><br><span class="line"><span class="comment">// [object Object]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义他的 Symbol.toStringTag 属性可以改变这个行为</span></span><br><span class="line"><span class="comment">// 此属性是一个字符串</span></span><br><span class="line">ValidatorClass.prototype[<span class="built_in">Symbol</span>.toStringTag] = <span class="string">&#x27;Validator&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> ValidatorClass()));</span><br><span class="line"><span class="comment">// [object Validator]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 顺便一提 dom 上有这个属性</span></span><br><span class="line"><span class="keyword">const</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(btn));</span><br><span class="line"><span class="comment">// [object HTMLButtonElement]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以看到 btn 的原型上是有 Symbol(Symbol.toStringTag) 这个 key 的</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf(btn)));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.toStringTag)]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(btn[<span class="built_in">Symbol</span>.toStringTag]);</span><br><span class="line"><span class="comment">// HTMLButtonElement</span></span><br></pre></td></tr></table></figure>

<p>上述代码使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertySymbols"><code>Object.getOwnPropertySymbols()</code></a> api，他可以返回一个对象的所有类型为 Symbol 的 key。所有对象初始时都是没有 Symbol 属性的（但是你可以去原型上找 Symbol）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols([]));</span><br><span class="line"><span class="comment">// []</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(&#123;&#125;));</span><br><span class="line"><span class="comment">// []</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf([])));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.iterator), Symbol(Symbol.unscopables)]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf(<span class="string">&#x27;zmy&#x27;</span>)));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.iterator)]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf(<span class="function">() =&gt;</span> &#123;&#125;)));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.hasInstance)]</span></span><br></pre></td></tr></table></figure>

<p>当然，有了这个属性之后你可以干些坏事了 🤫</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="regexp">/1/</span>));</span><br><span class="line"><span class="comment">// [object RegExp]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call([]));</span><br><span class="line"><span class="comment">// [object Array]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.toStringTag] = <span class="string">&#x27;RegExp&#x27;</span>;</span><br><span class="line"><span class="comment">// 这里虽然参数是数组，但由于你改了 toStringTag，所以“变成”了正则类型</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call([]));</span><br><span class="line"><span class="comment">// [object RegExp]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol-hasInstance"><a href="#Symbol-hasInstance" class="headerlink" title="Symbol.hasInstance"></a>Symbol.hasInstance</h3><p>它可以定义<code>instanceof</code>操作符的行为，是一个函数，有一个参数，是 <code>instanceof</code>操作符前的变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为 instanceof 操作符后面跟着是构造函数，所以要定义成静态属性</span></span><br><span class="line"><span class="comment">// 也就是要定义在构造函数 MyArray[Symbol.hasInstance] 上</span></span><br><span class="line"><span class="comment">// 而不是原型 MyArray.prototype[Symbol.hasInstance] 上</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> [<span class="built_in">Symbol</span>.hasInstance](instance) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(instance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([] <span class="keyword">instanceof</span> MyArray);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125; <span class="keyword">instanceof</span> MyArray);</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>还可以直接调用它来实现 <code>instanceof</code> 操作符的行为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cat = <span class="keyword">new</span> Animal();</span><br><span class="line"><span class="built_in">console</span>.log(Animal[<span class="built_in">Symbol</span>.hasInstance](cat));</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>所以你不用认为那些关键字是啥很厉害的东西，就像这里只是一个函数调用而已</p>
<h3 id="Symbol-species"><a href="#Symbol-species" class="headerlink" title="Symbol.species"></a>Symbol.species</h3><p>这是一个比较有趣的属性，你如果定义了一个自定义数组类，那么他使用 filter 等方法虽说返回的是新对象，但类型是不变的，如果你想要改变类型，就得使用 Symbol.species</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a1 = <span class="keyword">new</span> MyArray(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> a2 = a1.filter(<span class="function"><span class="params">x</span> =&gt;</span> x % <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a1 <span class="keyword">instanceof</span> MyArray);</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(a2 <span class="keyword">instanceof</span> MyArray);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>就像这里，a2 虽然是 filter 出来的新对象，但他仍然是 MyArray 的实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> get [<span class="built_in">Symbol</span>.species]() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a1 = <span class="keyword">new</span> MyArray(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> a2 = a1.filter(<span class="function"><span class="params">x</span> =&gt;</span> x % <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a2 <span class="keyword">instanceof</span> MyArray);</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(a2 <span class="keyword">instanceof</span> <span class="built_in">Array</span>);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>如果把 Symbol.species 属性设置成 Array 的话，那么即使 a1 是 MyArray 的实例，那么他 filter 出来的 a2 也不是 MyArray 的实例，而是 Symbol.species 属性值的实例</p>
<h3 id="Symbol-iterator"><a href="#Symbol-iterator" class="headerlink" title="Symbol.iterator"></a>Symbol.iterator</h3><p>如果想让你的对象能被 for of 遍历，那么就得使用 Symbol.iterator 属性，他是一个 Generator 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串和数组上都有 Symbol.iterator 属性，所以他们能被 for of 遍历</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf([]));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.iterator), Symbol(Symbol.unscopables)]</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(<span class="built_in">Object</span>.getPrototypeOf(<span class="string">&#x27;str&#x27;</span>));</span><br><span class="line"><span class="comment">// [Symbol(Symbol.iterator)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterable = &#123;&#125;;</span><br><span class="line">iterable[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;zmy&#x27;</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;learn&#x27;</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;symbol&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// zmy</span></span><br><span class="line"><span class="comment">// learn</span></span><br><span class="line"><span class="comment">// symbol</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以使用 spread 运算符</span></span><br><span class="line"><span class="keyword">const</span> list = [...iterable];</span><br><span class="line"><span class="built_in">console</span>.log(list);</span><br><span class="line"><span class="comment">// [&#x27;zmy&#x27;, &#x27;learn&#x27;, &#x27;symbol&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>字符串与数组自带 Symbol.iterator 属性，可以调用生成迭代器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;zmy&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> g = s[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"><span class="built_in">console</span>.log(g.next());</span><br><span class="line"><span class="built_in">console</span>.log(g.next());</span><br><span class="line"><span class="built_in">console</span>.log(g.next());</span><br><span class="line"><span class="built_in">console</span>.log(g.next());</span><br><span class="line"><span class="comment">// &#123;value: &#x27;z&#x27;, done: false&#125;</span></span><br><span class="line"><span class="comment">// &#123;value: &#x27;m&#x27;, done: false&#125;</span></span><br><span class="line"><span class="comment">// &#123;value: &#x27;y&#x27;, done: false&#125;</span></span><br><span class="line"><span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>这时如果 next 函数返回 Promise 怎么办呢？就需要使用 asyncIterator 和 for await of 了</p>
<p>对于迭代器与生成器推荐看这篇了解一下：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903735534026765">ES9 中的异步迭代器（Async iterator）和异步生成器（Async generator）</a></p>
<h3 id="Symbol-asyncIterator"><a href="#Symbol-asyncIterator" class="headerlink" title="Symbol.asyncIterator"></a>Symbol.asyncIterator</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span>* <span class="title">asyncGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> asyncIterator = asyncGenerator();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> asyncIterator[<span class="built_in">Symbol</span>.asyncIterator]);</span><br><span class="line"><span class="comment">// &#x27;function&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">const</span> value <span class="keyword">of</span> asyncIterator) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">run();</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for...await...of可以遍历具有Symbol.asyncIterator方法的数据结构</span></span><br><span class="line"><span class="comment">// 并且会等待上一个成员状态改变后再继续执行</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol-unscopables"><a href="#Symbol-unscopables" class="headerlink" title="Symbol.unscopables"></a>Symbol.unscopables</h3><p>值是对象，属性名加布尔值，用 with 的时候，如果为 ture，就不能取值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> object1 = &#123;</span><br><span class="line">    <span class="attr">property1</span>: <span class="number">42</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">object1[<span class="built_in">Symbol</span>.unscopables] = &#123;</span><br><span class="line">    <span class="attr">property1</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> (object1) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(property1);</span><br><span class="line">    <span class="comment">// expected output: Error: property1 is not defined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Symbol-isConcatSpreadable"><a href="#Symbol-isConcatSpreadable" class="headerlink" title="Symbol.isConcatSpreadable"></a>Symbol.isConcatSpreadable</h3><p>内部 @@isConcatSpreadable 属性，是布尔值，代表 Array.prototype.concat() 调用时是否拍平数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> alpha = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> numeric = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> alphaNumeric = alpha.concat(numeric);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(alphaNumeric);</span><br><span class="line"><span class="comment">// expected output: Array [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, 1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">numeric[<span class="built_in">Symbol</span>.isConcatSpreadable] = <span class="literal">false</span>;</span><br><span class="line">alphaNumeric = alpha.concat(numeric);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(alphaNumeric);</span><br><span class="line"><span class="comment">// expected output: Array [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, Array [1, 2, 3]]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol-match-等-string-相关-Symbol"><a href="#Symbol-match-等-string-相关-Symbol" class="headerlink" title="Symbol.match 等 string 相关 Symbol"></a>Symbol.match 等 string 相关 Symbol</h3><p>Symbol.match、Symbol.matchAll、Symbol.replace、Symbol.search、Symbol.split，和上文类似，都是在对应 String.prototype 的函数一些特殊处理，有需要再查阅即可</p>
<h2 id="实现私有属性"><a href="#实现私有属性" class="headerlink" title="实现私有属性"></a>实现私有属性</h2><p>Symbol 的另一个作用实现私有属性，可参考<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/SusZu6rdVijZ-6seg9oa0Q">私有属性的 6 种实现方式，你用过几种？</a></p>
<p>参考：</p>
<ol>
<li>mdn symbol：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/17/JavaScript/symbol/" data-id="cl5pg3mnd0011bpor863h53g2" data-title="JavaScript Symbol 解读" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-JavaScript/defineProperty" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/10/JavaScript/defineProperty/" class="article-date">
  <time class="dt-published" datetime="2022-07-10T00:00:00.000Z" itemprop="datePublished">2022-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/10/JavaScript/defineProperty/">defineProperty 详细解读</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>对象在 JS 中很重要，如 Number Function 等等都是以对象为基础扩展的，<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">defineProperty</a> 作为定义对象属性的 api，同样不可小觑。本文会详细解读 Object.defineProperty()，带你看透对象的本质。</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-07/11_21:12_gQBBo9.png" alt="image-2022071191209134 PM"></p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>defineProperty 是 Object 的静态方法，可以在对象上新增一个属性，或者更改对象上已有的属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;foo&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">42</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.foo = <span class="number">77</span>;</span><br><span class="line"><span class="comment">// 严格模式下会报错</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.foo);</span><br><span class="line"><span class="comment">// 非严格模式下输出 42</span></span><br></pre></td></tr></table></figure>

<p>对象 obj 定义了一个属性 foo，这个属性不能更改，否则会报错（我们现在写的代码几乎都是在严格模式下的，所以本文不考虑非严格模式下的情况）</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(obj, prop, descriptor)</span><br></pre></td></tr></table></figure>

<p>obj：你要定义的对象</p>
<p>prop：你要定义的属性，可以是 symbol 类型</p>
<p>descriptor：对于属性的描述</p>
<p>这里最重要的就是 descriptor 了</p>
<h2 id="descriptor-解读"><a href="#descriptor-解读" class="headerlink" title="descriptor 解读"></a>descriptor 解读</h2><p>我们正常的创建、修改、删除和枚举属性是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增属性（定义对象时直接赋值，或者在定义对象后动态赋值）</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line">obj.b = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改属性</span></span><br><span class="line">obj.a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除属性</span></span><br><span class="line"><span class="keyword">delete</span> obj.a;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举属性（四种方式：Object.keys、for in 操作、Object.assign、扩展操作符）</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br></pre></td></tr></table></figure>

<p>但你可能不希望属性被修改与删除，那就需要 defineProperty 出场了</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-07/11_20:28_pyNAWY.png" alt="image-2022071182854317 PM"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&#x27;e&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;zmy&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看属性，虽然控制台输出能看到 e，但 e 是浅色的</span></span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"><span class="comment">// 枚举属性 没有 e</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br><span class="line"><span class="comment">// 修改属性，报错</span></span><br><span class="line">obj.e = <span class="string">&#x27;mq&#x27;</span>;</span><br><span class="line"><span class="comment">// 删除属性，报错</span></span><br><span class="line"><span class="keyword">delete</span> obj.e</span><br></pre></td></tr></table></figure>

<p>这里，在 obj 上新定义了 e 属性，但它不能修改，不能删除也不能枚举。下面我们看看为什么会这样。</p>
<h3 id="数据属性和访问器属性"><a href="#数据属性和访问器属性" class="headerlink" title="数据属性和访问器属性"></a>数据属性和访问器属性</h3><p>在继续之前你需要知道：根据描述符的种类把属性分为两种，数据（data）属性和访问器（accessor）属性。</p>
<p>数据属性描述符：</p>
<ol>
<li><p>value：属性的值，默认 undefined</p>
</li>
<li><p>writable：属性是否可改变，默认 false</p>
</li>
</ol>
<p>访问器属性：</p>
<ol>
<li><p>get：函数，返回值是属性的值，可用this</p>
</li>
<li><p>set：函数，有一个参数，赋值时被调用，可用this</p>
</li>
</ol>
<p>还有两个描述符，是数据属性和访问器属性都有的：</p>
<ol>
<li>configurable：如果是false，那么：这个属性不能在数据属性和访问器属性之间切换了、属性不能被删除、其他的属性描述符不能被更改了（但当writable描述符是true时，属性的值可以改，writable描述符也可以改为false），默认false</li>
<li>enumerable：是否可枚举（四种方式：Object.keys、for in 操作、Object.assign、扩展操作符），默认false</li>
</ol>
<p>描述符只能是 value 和 writable 组合或 get 和 set 组合，不能混用（会报错）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;b&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;c&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Uncaught TypeError: Invalid property descriptor. Cannot both specify accessors and a value or writable attribute,</span></span><br></pre></td></tr></table></figure>

<p>但属性可以在数据属性和访问器属性之间来回切换：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(zmy.a);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(zmy.a);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyDescriptor(zmy, <span class="string">&#x27;a&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123;set: undefined, enumerable: false, configurable: true, get: ƒ&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">3</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(zmy.a);</span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>如上 a 属性从数据属性变为访问器属性又变为数据属性，这里注意：我在新增a属性时，configurable设置为true（因为如果是默认的false值，就不能在数据属性和访问器属性之间互相切换了），但第二次修改 a 属性时，并没有特殊设置configurable 的值，它依旧是 true，因为使用了新建时已有的 configurable 的值</p>
<h3 id="定义-descriptor-时的注意点"><a href="#定义-descriptor-时的注意点" class="headerlink" title="定义 descriptor 时的注意点"></a>定义 descriptor 时的注意点</h3><p>定义 descriptor 时最好是给出所有配置，因为这些配置项也可以是继承而来，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.writable = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> descriptor = &#123; <span class="attr">value</span>: <span class="number">8</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;a&#x27;</span>, &#123; <span class="attr">value</span>: <span class="number">8</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(zmy.a);</span><br><span class="line"><span class="comment">// 8</span></span><br><span class="line">zmy.a = <span class="number">7</span></span><br><span class="line"><span class="built_in">console</span>.log(zmy.a);</span><br><span class="line"><span class="comment">// 7</span></span><br><span class="line"><span class="built_in">console</span>.log(descriptor);</span><br></pre></td></tr></table></figure>

<p>这里由于 defineProperty 的 descriptor 中并没有显示指出 writable，所以它应该是默认值 false 的，故下面的 <code>zmy.a = 7</code> 应该报错，但事实却没有，因为我们在第一行改了<code>Object</code>的原型，导致所有对象都可以找到<code>writable</code>这个属性，所以在defineProperty时就被使用了，这里的 <code>writable</code> 实际为 <code>true</code> 而不是默认值 <code>false</code>（把第一行修改<code>Object</code>原型代码注释，就会正常报错）</p>
<p>当然解决这个问题还有其他方法：</p>
<ol>
<li>如果你的环境下<code>Object.freeze</code>可用，那么就 freeze 住<code>Object</code>实例的原型</li>
<li>descriptor对象使用<code>Object.create(null)</code>获得，因为这样获得的对象不继承于Object</li>
</ol>
<h3 id="configurable-为-false-的注意点"><a href="#configurable-为-false-的注意点" class="headerlink" title="configurable 为 false 的注意点"></a>configurable 为 false 的注意点</h3><p>configurable 为 false 的时候代表不可配置的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">zmy.q = <span class="number">6</span></span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot assign to read only property &#x27;q&#x27; of object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//  Uncaught TypeError: Cannot redefine property: q</span></span><br></pre></td></tr></table></figure>

<p>如上，改值和改描述符都报错，但有个特殊情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以更改值</span></span><br><span class="line">zmy.q = <span class="number">6</span>;</span><br><span class="line"><span class="built_in">console</span>.log(zmy.q);</span><br><span class="line"><span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以正常的把 writable 由 true 变为 false</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是把 writable 由 false 变为 true 是会报错的</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Uncaught TypeError: Cannot redefine property: q</span></span><br></pre></td></tr></table></figure>

<p>当 configurable 为 false，但是 writable 为 true 时，可以改变属性的 value，可以把 writable 由 true 变为 false，但是把 writable 由 false 变为 true 是会报错的。</p>
<p>（为啥要搞这么麻烦的事呢，我猜一个原因是<code>Object.getOwnPropertyDescriptors([])</code> ，这里 length 属性 configurable就是false，但 writable 为 true，又因为我们是能手动改数组的长度的，所以很符合这种情况）</p>
<p>如果定义的值和原值一样，不会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有报错，但是如果改成 5 以外的其他值，是都会报错的</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="属性值为-undefined"><a href="#属性值为-undefined" class="headerlink" title="属性值为 undefined"></a>属性值为 undefined</h3><p>把属性值变成 undefined 可以删除值 （configurable 等如果是 undefined 就代表是 false）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zmy = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    a = val;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">zmy.q = <span class="number">23</span></span><br><span class="line"><span class="comment">// 可以正常赋值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(zmy, <span class="string">&#x27;q&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">set</span>: <span class="literal">undefined</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">zmy.q = <span class="number">45</span></span><br><span class="line"><span class="comment">// 报错，因为没有 set</span></span><br></pre></td></tr></table></figure>

<h3 id="enumerable-举例"><a href="#enumerable-举例" class="headerlink" title="enumerable 举例"></a>enumerable 举例</h3><ol>
<li>Object.assign 和 扩展操作符：只有enumerable为true时可见，包括 symbol 类型</li>
<li>for in 操作  和 Object.key：只有enumerable为true时可见，不包括 symbol 类型</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="string">&#x27;a&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="string">&#x27;b&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="string">&#x27;c&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">3</span></span><br><span class="line">&#125;); <span class="comment">// enumerable 默认为 false</span></span><br><span class="line">o.d = <span class="number">4</span>; <span class="comment">// enumerable 默认为 true</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="built_in">Symbol</span>.for(<span class="string">&#x27;e&#x27;</span>), &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(o, <span class="built_in">Symbol</span>.for(<span class="string">&#x27;f&#x27;</span>), &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">6</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> o) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// logs &#x27;a&#x27; and &#x27;d&#x27; (in undefined order)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(o); <span class="comment">// [&#x27;a&#x27;, &#x27;d&#x27;]</span></span><br><span class="line"></span><br><span class="line">o.propertyIsEnumerable(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">o.propertyIsEnumerable(<span class="string">&#x27;b&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">o.propertyIsEnumerable(<span class="string">&#x27;c&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">o.propertyIsEnumerable(<span class="string">&#x27;d&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">o.propertyIsEnumerable(<span class="built_in">Symbol</span>.for(<span class="string">&#x27;e&#x27;</span>)); <span class="comment">// true</span></span><br><span class="line">o.propertyIsEnumerable(<span class="built_in">Symbol</span>.for(<span class="string">&#x27;f&#x27;</span>)); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = &#123; ...o &#125;</span><br><span class="line"><span class="comment">// 或者使用 assign，和 扩展操作符一样的</span></span><br><span class="line"><span class="comment">// const p = &#123;&#125;</span></span><br><span class="line"><span class="comment">// Object.assign(p, o)</span></span><br><span class="line">p.a <span class="comment">// 1</span></span><br><span class="line">p.b <span class="comment">// undefined</span></span><br><span class="line">p.c <span class="comment">// undefined</span></span><br><span class="line">p.d <span class="comment">// 4</span></span><br><span class="line">p[<span class="built_in">Symbol</span>.for(<span class="string">&#x27;e&#x27;</span>)] <span class="comment">// 5</span></span><br><span class="line">p[<span class="built_in">Symbol</span>.for(<span class="string">&#x27;f&#x27;</span>)] <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文讲解了defineProperty的定义与语法，并对descriptor的配置进行了代码实践。</p>
<p>我认为 defineProperty 是对象中非常重要的 api，你懂了这个再看其他的api仿佛打通了任督二脉，也就不会那么难了</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-07/11_20:31_8IXXKP.png" alt="image-2022071183144923 PM"></p>
<p>如：</p>
<ol>
<li><code>Object.defineProperties()</code>就是同时定义多个属性</li>
<li><code>Object.getOwnPropertyDescriptor()</code>就是获取到对象属性的描述符<code>Object.getOwnPropertyDescriptors()</code>也同理啦</li>
<li><code>Object.getOwnPropertyNames()</code>就是获取到所有的属性，包括<code>enumerable</code>为false的属性也能获取到，但不能获取到symbol类型的属性，那我想要获取到所有symbol类型的属性（包括<code>enumerable</code>为false的）该怎么办呢？用<code>Object.getOwnPropertySymbols()</code>即可</li>
<li><code>Object.prototype.propertyIsEnumerable()</code>就不用我说了吧</li>
</ol>
<p>还有很多，剩下的你可以自己去探索一下啦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/10/JavaScript/defineProperty/" data-id="cl5pg3mna000rbpor6azeeuox" data-title="defineProperty 详细解读" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-tools/在 mac 中像 windows 一样切换应用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/05/tools/%E5%9C%A8%20mac%20%E4%B8%AD%E5%83%8F%20windows%20%E4%B8%80%E6%A0%B7%E5%88%87%E6%8D%A2%E5%BA%94%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2022-07-05T00:00:00.000Z" itemprop="datePublished">2022-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/05/tools/%E5%9C%A8%20mac%20%E4%B8%AD%E5%83%8F%20windows%20%E4%B8%80%E6%A0%B7%E5%88%87%E6%8D%A2%E5%BA%94%E7%94%A8/">在 Mac 中像 Windows 一样切换应用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>众所周知，Mac 中的 command + tab 可以切换应用，但有时它并不是那么好用</p>
<h2 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h2><ol>
<li>一个应用有多个窗口时，鬼知道它会给你切换到哪个窗口，比如我的 Chrome（比如单独打开调试窗口） 和 vscode（比如多个项目） 经常会开多个窗口，这之间的切换简直像噩梦一样</li>
<li>也许你会说：一个应用之间切换窗口可以用 command +  ` 呀，是的，但如果你这一个应用的多个窗口在不同桌面的话，这个依然还是不行</li>
</ol>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>直到有一天我遇到了 <a target="_blank" rel="noopener" href="https://github.com/lwouis/alt-tab-macos">AltTab</a> 这个开源软件，它解决了一个应用的多个窗口在不同桌面的问题，并且在它的展示中，一个应用的不同窗口也会被展示出来</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-07/05_13:33_1XLOui.png" alt="image-2022070513335596 PM"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/05/tools/%E5%9C%A8%20mac%20%E4%B8%AD%E5%83%8F%20windows%20%E4%B8%80%E6%A0%B7%E5%88%87%E6%8D%A2%E5%BA%94%E7%94%A8/" data-id="cl5pg3mnp001qbporbgdp2dhs" data-title="在 Mac 中像 Windows 一样切换应用" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-weekly/09" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/07/03/weekly/09/" class="article-date">
  <time class="dt-published" datetime="2022-07-03T21:12:15.000Z" itemprop="datePublished">2022-07-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/07/03/weekly/09/">明远周刊：如何学习一门新技术</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>👀 本期看点：</p>
<ul>
<li>如何学习一门新技术</li>
<li>6个学习习惯和方法</li>
<li>链表题目</li>
<li>对象方法添加异常</li>
<li>Prefetch、Preload</li>
</ul>
<h2 id="📃-文章"><a href="#📃-文章" class="headerlink" title="📃 文章"></a>📃 文章</h2><p>👉 <a target="_blank" rel="noopener" href="https://www.bmpi.dev/dev/how-to-learn-tech/">如何学习一门技术</a> </p>
<p>作者以其自身学习 WebRTC 这个新技术为例，讲述了一些学习的方法。</p>
<ol>
<li>是否要学习这门技术？<ol>
<li>从知识体系出发：学习顶层的技术需要掌握一定的底层技术，如果这个底层技术被很多高层技术依赖，那么就值得学习</li>
<li>从应用前景出发：有市场需求，能赚钱</li>
</ol>
</li>
<li>怎么学？<ol>
<li><strong>善用搜索，找到对的资料和对的人</strong>。学习本身不是一件复杂的事情，因为它不是做研究（探索未知的东西），只是站在巨人的肩膀上把已经被解决的问题学习一遍。这里的难点在于资料千千万，很容易找到错误的资料，让学习变得很复杂</li>
<li>主动搜索：多用Google英文搜索，对比选择下要看的资料；多用谷歌图片搜索，图的层次上更容易了解整体架构；多去逛GitHub、YouTube、Twitter等获取开源项目、教学视频、大佬的演讲与动态等；</li>
<li>技术标准：不必看细节，要更高层次的理解技术特性</li>
<li>了解技术历史</li>
<li>做好笔记：搜索而来的资料和自己的总结如果不做整理与记录的话，时间久了就全忘了，最好整理到 <a target="_blank" rel="noopener" href="https://www.bmpi.dev/self/okr-gtd-note-logseq/">Logseq</a> 等这种多个笔记之间有连接关系的软件中，这种链接符合大脑的思考，更方便记忆</li>
<li>制定学习计划：规划时间消化学习资料</li>
<li>讲给别人听（写文章也算是一种），这样能使你的知识梳理更全面，还方便你后续整合成文章</li>
<li>可以在讨论区、社区、issue等寻求帮助</li>
<li>心里建设：勇敢承认自己不懂，不懂就去学与问，可怕的是不懂却隐藏，会使问题变得更复杂</li>
</ol>
</li>
<li>怎么用？<ol>
<li>学以致用是学习的最终目的，只有真正去用这个技术，才能真正掌握它，否则花费时间去学习，不用的话很快就忘了</li>
<li>从一些现有的开源项目中改造，做一个自己的应用（或者从零开始实现应用，但这往往都比较难）</li>
</ol>
</li>
</ol>
<p>（文章质量很高，作者应该很厉害，可以关注）</p>
<p>👉 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/fGYFE3k_P9CiHDJyZUM5IQ">新拾取的 6 个习惯和方法</a></p>
<ol>
<li>教给别人是最好的学习方式：可以清空大脑（把资料从大脑转移到文章中），更多的产出文章（好看的简历）</li>
<li>看的文章多了，自然也有自己的思考，「不要在输入不足的时候强行领悟」（我自己有时想写东西，但有写不出来，可能就是输入不够）</li>
<li>多解除新技术，多折腾，并愿意为此多花时间，如：别 React 18 出来了，还在用 React 16</li>
<li>早起工作，要专注（别看无用的消息），先做困难的事情</li>
<li>思考某些工作是否有十倍效率的解法</li>
<li>多做本质解，不做或少做现象解（看透本质能举一反三，不要去花很多时间学习三）</li>
</ol>
<p>👉 <a target="_blank" rel="noopener" href="https://labuladong.gitee.io/algo/2/18/17/">双指针技巧秒杀七道链表题目</a></p>
<p>通俗讲解几道链表力扣题目，在学习完链表理论知识后，可到这里实践一下，刷题顺序推荐：</p>
<ol>
<li>合并两个有序链表</li>
<li>链表的中间节点</li>
<li>删除链表的倒数第n个节点</li>
<li>环形链表 和 环形链表2</li>
<li>相交链表</li>
</ol>
<p>（你可能觉得有些题目很简单，比如「合并两个有序链表」，这不就是把两个链表都遍历一遍，之后存到数组里，再对数组排个序，之后通过排序的数组在生成新的链表就完事了嘛，为啥要像本文一样搞的这么复杂？因为你的方法时间复杂度、空间复杂度更高，排序需要O(nlogn)时间复杂度，存数组又需要O(m+n)空间复杂度，m和n分别代表两个链表的长度，但如果用本文解法的话，就会高明很多，时间复杂度就只是遍历一遍，是O(m+n)，空间复杂度就是两个指针的空间，即O(1)，所以面试官想看到的是这样的回答，而且一般真实场景下，你已经使用了链表数据结构，是没有必要再用数组数据结构存储一遍重复数据的）</p>
<p>👉 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/hehUH9HL6unaLWq3LzQxNg">如何优雅地给对象的所有方法添加异常处理</a></p>
<p>在每个方法中都使用 try catch 来捕获异常未免有些重复与麻烦，本文通过代理模式的思考方式使用 proxy api 给函数统一添加异常处理，还考虑了异步函数的情况（我也写过很多重复的 try catch，为啥就没想到统一处理下呢😥）</p>
<p>👉 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6893681741240909832">使用 Preload&amp;Prefetch 优化前端页面的资源加载</a></p>
<p>对于前端页面来说，静态资源的加载对页面性能起着至关重要的作用。本文将介绍浏览器提供的两个资源指令 preload/prefetch，它们能够辅助浏览器优化资源加载的顺序和时机，提升页面性能。</p>
<p>它们都写在link标签上，head标签里，prefetch可以用低优先级预先加载静态资源，列表页能跳转到详情页，详情页有几个固定图片，那么你可以在列表页写上图片的prefetch，那么浏览器在空闲时就能加载这些图片，用户如果跳到了详情页后就能直接使用prefetch的缓存，直接展示图片，而不用再去等待请求时间。</p>
<p>preload，有as属性（有多种类型可选），通过标签显式声明一个高优先级资源，强制浏览器提前请求资源，同时不阻塞文档正常onload。</p>
<p>（这些叫做 Resource Hints，还有<a target="_blank" rel="noopener" href="https://juejin.cn/post/6915204591730556935">preconnect 和 dns-prefetch</a>）</p>
<p>👉 <a target="_blank" rel="noopener" href="https://ainyi.com/51">关于 Vue 不能 watch 数组 和 对象变化的解决方案</a></p>
<p>展示了vue什么时候不能监听数组与对象的变化，以及解决方案</p>
<p>（写的简洁清晰，很不错的博客）</p>
<h2 id="🤔-想法"><a href="#🤔-想法" class="headerlink" title="🤔 想法"></a>🤔 想法</h2><ol>
<li>「我们应该做一个积极行动的悲观主义者，对未来低期望，但只要是值得的，就坚定去做。」来自：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2022/03/weekly-issue-200.html">科技爱好者周刊（第 200 期）：低期望，多尝试</a><ol>
<li>我在写文章的时候，总高期望的以为自己能获得多少阅读量，多少点赞，如果没有达到预期的话，就会有些失望。其实不应该这样，这是有价值并且值得的事情，坚持去做就可以了，并且降低期望。</li>
</ol>
</li>
<li>要和理想中的自己比较，不要和别人比较</li>
<li>微信读书 记笔记的方式很好，划线原文加上感想，最好还能总结出文章来</li>
<li>学习东西要记笔记，最好把内容记忆背诵下来，熟练使用旧知识，才能思考出新知识。</li>
<li>一个高效学习方法：教给别人（和别人交流、写文章、做分享）</li>
<li>学习更适应时机的内容：比如你最近的工作内容是做性能优化，但你最近在提升自己的操作系统相关知识，那你就可以先暂停这部分的提示，转向性能优化方面的学习，这样也能在团队内做出一些成绩，并且能应用在复杂的实际项目中</li>
</ol>
<p><em>2022-03-19 ~ 2022-07-03（第 9 期）</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/07/03/weekly/09/" data-id="cl5pg3mo1002kbporh35lchqu" data-title="明远周刊：如何学习一门新技术" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-weekly/08" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/03/19/weekly/08/" class="article-date">
  <time class="dt-published" datetime="2022-03-19T21:21:53.000Z" itemprop="datePublished">2022-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/03/19/weekly/08/">明远周刊：字符在计算机的存储形式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>本期看点</p>
<ul>
<li>浏览器 observer api</li>
<li>LRU JS 实现</li>
<li>字符在计算机的存储形式</li>
<li>手写 Promise</li>
<li>queueMicrotask 实现微任务</li>
<li>前端依赖管理的痛点</li>
<li>手写 parseInt</li>
</ul>
<h2 id="文章"><a href="#文章" class="headerlink" title="文章"></a>文章</h2><h3 id="浏览器的-5-种-Observer，你用过几种？"><a href="#浏览器的-5-种-Observer，你用过几种？" class="headerlink" title="浏览器的 5 种 Observer，你用过几种？"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-fLZe164aWAaPJ55iZ_m2w">浏览器的 5 种 Observer，你用过几种？</a></h3><p>网页处理用户交互，可添加 click、mousemove 等事件，但有些操作不是由用户直接触发的，那么就要使用 observer api 了。</p>
<p>IntersectionObserver：</p>
<p>监听元素和可视区域相交比例。使用场景：埋点数据采集（当前元素是否可见以及可见比例）、图片懒加载。</p>
<p>MutationObserver：</p>
<p>监听元素属性的修改、以及子节点的增删改。使用场景：防止用户使用 devTool 去水印。</p>
<p>ResizeObserver：</p>
<p>监听大小的改变，当 width、height 被修改时触发。</p>
<p>PerformanceObserver：</p>
<p>监听记录 performance 数据的行为，一旦记录了就会触发回调，可在回调里把这些数据进行上报。</p>
<p>ReportingObserver：</p>
<p>浏览器遇到过时 api 会打印警告，在一些情况下还会对网页进行干预，此 api 可监听这些动作。</p>
<h3 id="蚂蚁金服在线笔试：设计和实现一个LRU缓存机制"><a href="#蚂蚁金服在线笔试：设计和实现一个LRU缓存机制" class="headerlink" title="蚂蚁金服在线笔试：设计和实现一个LRU缓存机制"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/bNMaEXyyPli0OiZpio2kbg">蚂蚁金服在线笔试：设计和实现一个LRU缓存机制</a></h3><p>LRU 是 Least Recently Used 的缩写，是一种常用的页面置换算法，页面置换与CPU、内存、磁盘有关，你可以简单理解为这是一种缓存算法，但有容量限制。</p>
<p>本文解决了力扣上的 <a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/lru-cache/">LRU缓存</a> 题目。Vue 中也使用了此算法，可参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/E0yzNyDApc_XB7r_5ciX_g">LRU 缓存-keep-alive 实现原理</a></p>
<h3 id="淦，为什么-“𠮷𠮷𠮷”-length-3"><a href="#淦，为什么-“𠮷𠮷𠮷”-length-3" class="headerlink" title="淦，为什么 “𠮷𠮷𠮷” .length !== 3"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/7025400771982131236">淦，为什么 “𠮷𠮷𠮷” .length !== 3</a></h3><p>字符串的 length 属性不能完全正确的表示字符串长度，他的深层原因涉及字符编码，推荐看下文中作者关于编码的前两篇文章，这样看本文的时候能便于理解一些。简单讲就是 JavaScript 字符串使用 utf 16 编码，这种编码的产物只可能是2字节或4字节，JavaScript由于历史原因，认为2字节的 length 就是1，所以 ‘💩’ 的占了4个字节，那么他的length就是2，slice, split, substr 等等方法对于 length 的处理也存在同样的问题。为啥 ‘💩’ 就占4个字节了呢？再简单讲就是这个字符使用了Unicode对应表，可在<a target="_blank" rel="noopener" href="https://unicode-table.com/en/">unicode-table</a>中查询对应值，就是这个字符对应了一个数字，数字就可以用二进制表示，因为数字太大了，所以2个字节不够用，就得占4个字节啦。</p>
<h3 id="深入分析-Promise-实现细节"><a href="#深入分析-Promise-实现细节" class="headerlink" title="深入分析 Promise 实现细节"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/6945319439772434469">深入分析 Promise 实现细节</a></h3><p>手写 Promise 应该是现在面试炽手可热的题目了（想当年我也被这个挂过🤫），本文由浅入深介绍了如何手写 Promise，先实现同步版本的，再实现异步，最后在加上 then 以及其他处理，逐步练习，比较有成就感。</p>
<h3 id="在-JavaScript-中通过-queueMicrotask-使用微任务"><a href="#在-JavaScript-中通过-queueMicrotask-使用微任务" class="headerlink" title="在 JavaScript 中通过 queueMicrotask() 使用微任务"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide">在 JavaScript 中通过 queueMicrotask() 使用微任务</a></h3><p>上篇手写 Promise 使用了 queueMicrotask，我居然都没听过这个函数😑。本文介绍了一些微任务的特性和 queueMicrotask 的示例，你可以理解为它就想 Promise.resolve().then 一样，就是添加一个微任务，但它比 Promise.resolve 要好得多。其中这3点很新奇：</p>
<ol>
<li>微任务自身可以产生微任务，并且事件循环会一直处理微任务队列，所以你递归增加微任务的话一定要谨慎，否则可能出现微任务一直执行不完的情况。</li>
<li>如果可能的话，大多数开发者不应该过多使用微任务。</li>
<li>使用微任务的典型场景：实在没有其他办法了、创建框架或库时需要使用微任务完成功能。</li>
</ol>
<p>（吐槽下，不知道是翻译的原因吗？读着有点难懂🥺）</p>
<h3 id="关于依赖管理的真相-—-前端包管理器探究"><a href="#关于依赖管理的真相-—-前端包管理器探究" class="headerlink" title="关于依赖管理的真相 — 前端包管理器探究"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/t6RZAKb6mXTfXl7XbpZ_vw">关于依赖管理的真相 — 前端包管理器探究</a></h3><p>关于前端依赖管理，已经有很多不错的文章解释了，但这篇最近的文章给出了准确的分类，丰富了一些细节，如：</p>
<ol>
<li>不确定性：不用 lock 的话，你本地安装的 node_modules 和线上重新安装的是可能不同的，那么就会造成你本地开发没有问题，但是线上有问题的情况，你要在新增一个依赖后本地删除 node_modules，再重新安装才能解决，这明显是没必要的，</li>
<li>当你安装了多个同版本的包在 node_modules 中时，会破坏单例模式以及引起 TS 的 types冲突（这点我真的没想到过）</li>
<li>Yarn v2 Plug’n’Play 原理，以及劣势：脱离Node现存生态，兼容性不好</li>
<li>pnpm 的硬链接与符号链接</li>
<li>cnpm/tnpm 的解决方案（我原以为cnpm就是做了个国内存储呢😂，原理还干了其他的事情）</li>
<li>Deno 的链接引包</li>
</ol>
<h3 id="被字节”装“到了，只要你能看”完“这题目，就算你过？"><a href="#被字节”装“到了，只要你能看”完“这题目，就算你过？" class="headerlink" title="被字节”装“到了，只要你能看”完“这题目，就算你过？"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/W6Of2T_xE5Pf2_01FSsjxg">被字节”装“到了，只要你能看”完“这题目，就算你过？</a></h3><p>类似手写 parseInt，文中使用正则实现的，比较简洁（正则的时间复杂度咋算呀？🤔）。</p>
<h2 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h2><blockquote>
<p>we will hold your hand and provide enough detail for you to feel comfortable and learn the topics properly.</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Learn/">原文链接</a></p>
</blockquote>
<p>好的学习方式应该是有成就感的、开心的、舒服的、由浅入深逐步递进的。</p>
<p><em>2022-02-27 ~ 2022-03-19（第 8 期）</em></p>
<p>最近鸽的有点厉害😣，还是尽量每周一篇吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/03/19/weekly/08/" data-id="cl5pg3mnz002hbpor07q777ay" data-title="明远周刊：字符在计算机的存储形式" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-operating-system/float" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/03/01/operating-system/float/" class="article-date">
  <time class="dt-published" datetime="2022-03-01T17:39:23.000Z" itemprop="datePublished">2022-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/03/01/operating-system/float/">浮点数与二进制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>浮点数在我们的生活中处处可见，如你在清空购物车时，就需要结算所支付的金额。但是如果你真正在计算机上使用过浮点数计算，就能知道有挺多坑的，本文会介绍下浮点数与二进制相关的知识，希望能解开你心中浮点数的迷惑，主要围绕以下几点展开：</p>
<ol>
<li>浮点数的误区，如：0.1 + 0.2 不等于 0.3</li>
<li>浮点数在计算机的存储方式，即 IEEE 754 标准介绍</li>
<li>特殊数字的由来，如 NaN、Number.MAX_SAFE_INTEGER 等</li>
<li>正确执行浮点数运算的方法</li>
</ol>
<h2 id="浮点数的误区"><a href="#浮点数的误区" class="headerlink" title="浮点数的误区"></a>浮点数的误区</h2><p>令人困惑的浮点数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>);</span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0.1 + 0.2 真的只等于 0.30000000000000004 吗？</span></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">    <span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.30000000000000004</span>,</span><br><span class="line">    <span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.30000000000000003</span>,</span><br><span class="line">    <span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.30000000000000002</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// true true true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// toFixed 函数</span></span><br><span class="line"><span class="comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">0.1</span>).toFixed(<span class="number">100</span>));</span><br><span class="line"><span class="comment">// 0.1000000000000000055511151231257827021181583404541015625000000000000000000000000000000000000000000000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">2.55</span>).toFixed(<span class="number">1</span>), (<span class="number">1.335</span>).toFixed(<span class="number">2</span>));</span><br><span class="line"><span class="comment">// 2.5 1.33</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span> === <span class="built_in">Number</span>.MAX_SAFE_INTEGER);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>下面我将为你解答这些奇怪现象背后的原因</p>
<h2 id="IEEE-754-标准"><a href="#IEEE-754-标准" class="headerlink" title="IEEE 754 标准"></a>IEEE 754 标准</h2><p>现代计算机中，IEEE 754 标准（IEEE 电气电子工程师学会 Institute of Electrical and Electronics Engineers）是使用最广泛的浮点数标准（JavaScript、C、Java、Python 等等很多编程语言都使用了此标准）</p>
<p>该标准以发布年份又区分 3 个版本，分别是 IEEE 754-1985、IEEE 754-2008、IEEE 754-2019，在 <a target="_blank" rel="noopener" href="https://262.ecma-international.org/12.0/#sec-terms-and-definitions-number-value">ECMAScript 2021 标准</a> 中可以发现，JavaScript 使用的正是 IEEE 754-2019 标准中的双精度 64 位格式</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-03/01_19:52_BkoPLT.png" alt="image-20220301195257453"></p>
<p>该标准定义了五种基本格式，其中最常用的便是单精度 32 位浮点数与双精度 64 位浮点数，下面主要讲解双精度浮点数（因为 JavaScript 中使用的是双精度浮点数，并且双精度浮点数与单精度浮点数也很类似）</p>
<p>该标准定义：浮点数由三个字段组成：符号位（sign）、指数（exponent）和尾数（fraction）</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-03/01_19:52_gVVuXr.png" alt="image-20220301195235285"></p>
<p><strong>符号位：</strong>占 1 位，0 代表正数，1 代表负数</p>
<p><strong>指数：</strong>占 11 位，能表示 2048 个数，即 [0, 2047]，但实际场景下指数的值可以是正数也可以是负数，所以引入了一个<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Exponent_bias">指数偏移基准值</a>（Exponent bias）：1023。举例来说：当指数的二进制值为 1025 时，代表指数的实际值为 2，因为 1023 + 2 = 1025，指数的二进制值为 1020 时，代表指数的实际值为 -3，因为 1023 - 3 = 1020。那么你会觉得指数实际值的范围是 [-1023, +1024]，但实际是 [-1022, +1023]，因为二进制全0、二进制全1，用于表示特殊值了</p>
<p><strong>尾数：</strong>占 52 位，但可以表示 53 位，因为开头开头第一位的值总为 1，为了节约存储空间，所以省略掉了</p>
<h3 id="浮点数转为二进制"><a href="#浮点数转为二进制" class="headerlink" title="浮点数转为二进制"></a>浮点数转为二进制</h3><p>以十进制 14.34375 为例，它是如何以二进制存储的？首先分别把整数部分与小数部分的二进制值计算出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">         1    4   .       3     4     3     7     5      </span><br><span class="line">      10^1 10^0   .   10^-1 10^-2 10^-3 10^-4 10^-5   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  1   1   1   0   .      0    1    0       1       1        </span><br><span class="line">2^3 2^2 2^1 2^0   .   2^-1 2^-2 2^-3    2^-4    2^-5  </span><br><span class="line"></span><br><span class="line">  8   2   4   0   .      0  0.25   0  0.0625  0.03125        </span><br></pre></td></tr></table></figure>

<p>小数点后面的二进制是如何计算出的？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0.34375 * 2 为 0.6875   第 1 位记 0</span><br><span class="line">0.6875 * 2  为 1.375    第 2 位记 1</span><br><span class="line">0.375 * 2   为 0.75     第 3 位记 0</span><br><span class="line">0.75 * 2    为 1.5      第 4 位记 1</span><br><span class="line">0.5 * 2     为 1        第 5 位记 1</span><br><span class="line"></span><br><span class="line">最终没有小数位了，计算结束，结果为 01011</span><br></pre></td></tr></table></figure>

<p>聪明的你肯定在这里发现了：有可能出现无限循环的情况呀，这个后面会讲</p>
<h4 id="定点数与科学记数法"><a href="#定点数与科学记数法" class="headerlink" title="定点数与科学记数法"></a>定点数与科学记数法</h4><p>现在拿到的值 1110.01011 叫做<strong>定点数</strong>，即小数点是固定位置不能改变的，那么如何拿到浮点数呢？这就要讲下科学计数法了：</p>
<p>给一个⼗进制数 1230000，可以表示为 1.23 x 10^6 或 12.3 x 10^5 等等，这种⽅式就称为科学记数法。该方法有一种格式叫做规格化，即⼩数点左边有且仅有⼀位非零数字，如 1.23 x 10^6 是规格化的，⽽ 12.3 x 10^5 和 0.123 x 10^7 就不是规格化的</p>
<h4 id="定点数转浮点数"><a href="#定点数转浮点数" class="headerlink" title="定点数转浮点数"></a>定点数转浮点数</h4><p>1110.01011 可转换为规格化的科学计数法，即 1.11001011 x 2^3，<strong>这里的 3 就是指数，11001011 就是尾数</strong>，不对，尾数前面有个 1 为什么没存呀？</p>
<p>因为这里使用了规格化的科学计数法，左边有且仅有⼀位非零数字，又因为使用的是二进制数据，第一位还必须是非零，那么就只有一种可能，第一位一定是 1，为了节省存储空间，所以不会存储这个值，这也就是上面说的：「尾数：占 52 位，但可以表示 53 位」</p>
<h4 id="十进制浮点数-0-1-转换为二进制的值是多少？"><a href="#十进制浮点数-0-1-转换为二进制的值是多少？" class="headerlink" title="十进制浮点数 0.1 转换为二进制的值是多少？"></a>十进制浮点数 0.1 转换为二进制的值是多少？</h4><p>先转换为二进制定点数，整数部分就是0，算一下小数部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0.1 * 2 === 0.2  记 0  </span><br><span class="line">0.2 * 2 === 0.4  记 0  </span><br><span class="line">0.4 * 2 === 0.8  记 0  </span><br><span class="line">0.8 * 2 === 1.6  记 1  </span><br><span class="line">0.6 * 2 === 1.2  记 1  </span><br><span class="line">0.2 * 2 === 0.4  记 0   这里开始无限循环了</span><br><span class="line">0.4 * 2 === 0.8  记 0  </span><br><span class="line">0.8 * 2 === 1.6  记 1  </span><br><span class="line">0.6 * 2 === 1.2  记 1  </span><br><span class="line">0.2 * 2 === 0.4  记 0   又继续无限循环</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>定点数为 0.0 0011 0011 0011 … 这里出现了无限循环，但浮点数位数是有限的，不可能存下那么多的值，所以无法用二进制精确表示 0.1，只能用近似值来表示，于是便造成了精度缺失的情况，其实这里你并不用惊讶，因为二进制不能正确表示 0.1 就和十进制不能表示 1/3 一样普通，对于这种情况，我们选择的是表示其近似值，就像十进制中，我们用 0.33 来代表 1/3 一样。</p>
<p>转换为规格化的科学计数法为：1.1 0011 0011 0011 … * 2^-4</p>
<p>指数应该为 1019</p>
<p>符号位：0</p>
<p>指数：01111111011</p>
<p>尾数：1001100110011001100110011001100110011001100110011010</p>
<p>也可以使用 <a target="_blank" rel="noopener" href="https://www.binaryconvert.com/convert_double.html">binaryconvert</a> 工具验证一下，结果是正确的</p>
<h3 id="二进制转为浮点数"><a href="#二进制转为浮点数" class="headerlink" title="二进制转为浮点数"></a>二进制转为浮点数</h3><p>现在可以反向得出二进制转为浮点数的换算公式了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">十进制 = (-1)^符号位 x (1 + 尾数) x 2^(指数 - 1023)</span><br></pre></td></tr></table></figure>

<h4 id="下面这个二进制转换为十进制浮点数的值是多少？"><a href="#下面这个二进制转换为十进制浮点数的值是多少？" class="headerlink" title="下面这个二进制转换为十进制浮点数的值是多少？"></a>下面这个二进制转换为十进制浮点数的值是多少？</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">符号位：0</span><br><span class="line"></span><br><span class="line">指数：10000000010</span><br><span class="line"></span><br><span class="line">尾数：0100110000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure>

<p>指数的值是 1026，因为 1023 + 3 = 1026，所以指数是 3</p>
<p>可得规格化的科学计数法为 1.010011 * 2^3</p>
<p>可得定点数是 1010.011</p>
<p>可得十进制值为 10.375</p>
<h3 id="0-1-toFixed-100"><a href="#0-1-toFixed-100" class="headerlink" title="(0.1).toFixed(100)"></a>(0.1).toFixed(100)</h3><p>至此，其实已经能解释这段代码了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log((<span class="number">0.1</span>).toFixed(<span class="number">100</span>));</span><br><span class="line"><span class="comment">// 0.1000000000000000055511151231257827021181583404541015625000000000000000000000000000000000000000000000</span></span><br></pre></td></tr></table></figure>

<p>浮点数转成二进制，之后再用二进制转为浮点数，结果就是这个值（手算计算量很大，可使用后面介绍的 decimal.js 精确计算）</p>
<p>虽然你定义的是 0.1 但实际上计算机在二进制存的值是 0.1000000000000000055511151231257827021181583404541015625，可通过 toFixed 方法获取到这个真实值</p>
<h3 id="特殊数字的由来"><a href="#特殊数字的由来" class="headerlink" title="特殊数字的由来"></a>特殊数字的由来</h3><p>上面说过，指数的二进制全0、二进制全1，用于表示特殊值了，如下：</p>
<h4 id="正负零"><a href="#正负零" class="headerlink" title="正负零"></a>正负零</h4><p>符号位：0代表正数，1代表负数</p>
<p>指数：全是0</p>
<p>尾数：全是0</p>
<h4 id="正负无穷"><a href="#正负无穷" class="headerlink" title="正负无穷"></a>正负无穷</h4><p>符号位：0代表正数，1代表负数</p>
<p>指数：全是1</p>
<p>尾数：全是0</p>
<h4 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h4><p>符号位：0或1都可以，无所谓</p>
<p>指数：全是1</p>
<p>尾数：任何非零值</p>
<p>（typeof NaN === ‘number’ 的原因找到了）</p>
<h4 id="Number-MAX-SAFE-INTEGER-Number-MIN-SAFE-INTEGER"><a href="#Number-MAX-SAFE-INTEGER-Number-MIN-SAFE-INTEGER" class="headerlink" title="Number.MAX_SAFE_INTEGER Number.MIN_SAFE_INTEGER"></a>Number.MAX_SAFE_INTEGER Number.MIN_SAFE_INTEGER</h4><p>符号位：0 代表正数，1 代表负数</p>
<p>指数：1023 + 52 = 1075 </p>
<p>尾数：全是 1</p>
<p>其实就是 53 个 1，即 2^53  - 1</p>
<h4 id="Number-MAX-VALUE-Number-MIN-VALUE"><a href="#Number-MAX-VALUE-Number-MIN-VALUE" class="headerlink" title="Number.MAX_VALUE Number.MIN_VALUE"></a>Number.MAX_VALUE Number.MIN_VALUE</h4><p>其实上述的 [-1022, 1023] 只是简单化处理了，如果深究的话，会更复杂（与 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Subnormal_number">Subnormal number</a> 有关），但可以简单理解为能表示的范围是 [-1074, 971]，<a target="_blank" rel="noopener" href="https://262.ecma-international.org/12.0/#sec-ecmascript-language-types-number-type">标准中</a>也有定义，故：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span>) * <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">971</span>) === <span class="built_in">Number</span>.MAX_VALUE <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, -<span class="number">1074</span>) === <span class="built_in">Number</span>.MIN_VALUE <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="正确执行浮点数运算的方法"><a href="#正确执行浮点数运算的方法" class="headerlink" title="正确执行浮点数运算的方法"></a>正确执行浮点数运算的方法</h2><h3 id="浮点数奇怪的本质"><a href="#浮点数奇怪的本质" class="headerlink" title="浮点数奇怪的本质"></a>浮点数奇怪的本质</h3><p>个人认为，浮点数奇怪的本质是：不能存储完整准确的二进制表示，但这是合理的，因为有无限循环的情况，是存储不完的</p>
<p>当遇到存储不完的的时候会怎样？会溢出，溢出分为上溢和下溢，这又是个复杂的问题，本文暂不讨论</p>
<h3 id="如何正确执行浮点数运算"><a href="#如何正确执行浮点数运算" class="headerlink" title="如何正确执行浮点数运算"></a>如何正确执行浮点数运算</h3><p>所有的数据计算都是准确的，当出现无限循环时，明确给出精度定义，超出精度的值舍弃掉，按照人脑的十进制方法去计算</p>
<p>缺点：自己实现起来费力并且也没必要，一般都要引入三方库，如 decimal.js</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文我介绍了浮点数的标准，即 IEEE 754 标准，还解释了一些特殊值以及常见误区的原因，最后简单分析了 decimal.js 的源码，希望能让你有所收获</p>
<p>现在回顾最初的问题，你都知道答案了吗？</p>
<p>这里使用到了浮点数的加法运算，在做加法前，首先要对齐指数，对齐指数时指数小的值会改为指数大的</p>
<p>如下是 0.1 与 0.2 的二进制值</p>
<table>
<thead>
<tr>
<th>value</th>
<th>s</th>
<th>e</th>
<th>d</th>
</tr>
</thead>
<tbody><tr>
<td>0.1</td>
<td><strong>0</strong></td>
<td><strong>01111111011</strong><br />1019 -&gt; -4</td>
<td><strong>1001100110011001100110011001100110011001100110011010</strong></td>
</tr>
<tr>
<td>0.2</td>
<td><strong>0</strong></td>
<td><strong>01111111100</strong><br />1020 -&gt; -3</td>
<td><strong>1001100110011001100110011001100110011001100110011010</strong></td>
</tr>
</tbody></table>
<p>指数对齐：把指数小的变为大的，即 0.1 的 e 由 -4 变为 -3</p>
<p>1.1001100110011001100110011001100110011001100110011010 * 2^-4</p>
<p>0.11001100110011001100110011001100110011001100110011010 * 2^-3</p>
<p>指数对齐后就是二进制的加法，没有的位置补0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0.2    1.10011001100110011001100110011001100110011001100110100</span><br><span class="line">0.1    0.11001100110011001100110011001100110011001100110011010</span><br><span class="line">ans   10.0110011001100110011001100110011001100110011001100111</span><br><span class="line"></span><br><span class="line">10.0110011001100110011001100110011001100110011001100111 * 2^-3</span><br><span class="line">1.00110011001100110011001100110011001100110011001100111 * 2^-2</span><br><span class="line"></span><br><span class="line">符号位：0</span><br><span class="line">指数：-2 即 1021 即 1111111101（二进制）</span><br><span class="line">尾数：00110011001100110011001100110011001100110011001100111</span><br><span class="line">尾数超长了，现在是 53 位，应该改为 52 位，丢弃的部分要使用舍入规则</span><br><span class="line">尾数：0011001100110011001100110011001100110011001100110100</span><br><span class="line"></span><br><span class="line">1.0011001100110011001100110011001100110011001100110100 * 2^-2</span><br><span class="line">0.010011001100110011001100110011001100110011001100110100 是定点数，那么计算值是</span><br><span class="line"></span><br><span class="line">Decimal.set(&#123; precision: 99 &#125;) // 替换到默认的 20 位精度，改为 99 位精度，因为这里计算的值太长了</span><br><span class="line">new Decimal(&#x27;0b0.010011001100110011001100110011001100110011001100110100&#x27;).equals((0.1+0.2).toFixed(100))</span><br><span class="line">// true</span><br><span class="line"></span><br><span class="line">最终，完美解释了 0.1 + 0.2 的值到底是怎么来的 🎉</span><br></pre></td></tr></table></figure>



<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/js-precision-problem-and-solution.html">JavaScript 中精度问题以及解决方案</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">双精度特殊值示例</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IEEE_754-1985">IEEE_754-1985 标准</a></p>
<p>[IEEE 名称解释](<a target="_blank" rel="noopener" href="https://www.ieee.org/about/ieee-history.html#:~:text=Related">https://www.ieee.org/about/ieee-history.html#:~:text=Related</a> links-,Meaning of I-E-E-E,is the full legal name.)</p>
<p><a target="_blank" rel="noopener" href="http://mikemcl.github.io/decimal.js/">decimal.js  JavaScript 中的任意精度运算</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=mKJiD2ZAlwM">HOW TO: Adding IEEE-754 Floating Point Numbers</a></p>
<p>为什么 0.1 + 0.2 不等于 0.3 ？来自：图解系统-小林 coding-v1.0 pdf</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/03/01/operating-system/float/" data-id="cl5pg3mnl001gbporefxqgr8w" data-title="浮点数与二进制" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-weekly/07" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/03/01/weekly/07/" class="article-date">
  <time class="dt-published" datetime="2022-03-01T17:39:23.000Z" itemprop="datePublished">2022-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/03/01/weekly/07/">明远周刊：从零实现栅格地图</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="看点"><a href="#看点" class="headerlink" title="看点"></a>看点</h2><ul>
<li><p>地图的经纬度、瓦片、墨卡托投影介绍与简单实现。</p>
</li>
<li><p>普通人的网页配色。</p>
</li>
<li><p>一些学习方法：主动接近大佬、围绕工作学、常用 debug、言之有物，不要无病呻吟、多查官方标准。</p>
</li>
</ul>
<h2 id="知识"><a href="#知识" class="headerlink" title="知识"></a>知识</h2><h3 id="从零打造一个-Web-地图引擎"><a href="#从零打造一个-Web-地图引擎" class="headerlink" title="从零打造一个 Web 地图引擎"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/7054729902871805966">从零打造一个 Web 地图引擎</a></h3><p>本文从零实现了一个栅格地图，栅格地图是由一个个小方块图片组成的，这个小方块叫瓦片，瓦片有固定的编号规则，后端生成了所有的瓦片，前端想要展示地图只要找到对应的瓦片显示出来即可，经纬度通过 web 墨卡托投影后能计算出对应的瓦片编号，之后计算出屏幕要展示的瓦片，以及监听拖动和缩放即可。</p>
<h3 id="普通人的网页配色方案"><a href="#普通人的网页配色方案" class="headerlink" title="普通人的网页配色方案"></a><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/03/coloring-scheme.html">普通人的网页配色方案</a></h3><p>没有 UI 设计，前端自己开发网页时，使用配色的建议。</p>
<p><strong>思考</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2008/07/color_theory.html">对于颜色的理解</a>，前端应该具备基本的美感，如：使用好看的颜色、合适的布局、边距使用 8 12 16 px 等等。</p>
<p>可选的配色：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2010/09/12_colors_used_in_web_design.html">网页设计的 12 种颜色</a>、<a target="_blank" rel="noopener" href="https://materialui.co/flatuicolors">各种国外 ui 的颜色</a>、<a target="_blank" rel="noopener" href="https://mui.com/zh/customization/color/">material ui color</a>、<a target="_blank" rel="noopener" href="https://getbootstrap.com/docs/5.1/customize/color/">bootstrap ui Color</a>、<a target="_blank" rel="noopener" href="https://ant.design/docs/spec/colors-cn">Ant Design 色彩</a>、<a target="_blank" rel="noopener" href="https://semi.design/zh-CN/basic/tokens">设计变量 Semi Design Tokens</a>、<a target="_blank" rel="noopener" href="https://arco.design/docs/spec/style-guideline">arco 设计</a>，以及<a target="_blank" rel="noopener" href="https://getcssscan.com/css-box-shadow-examples">好看的阴影</a>。</p>
<h3 id="vs-code-调试网页-JS-代码"><a href="#vs-code-调试网页-JS-代码" class="headerlink" title="vs code 调试网页 JS 代码"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg3OTYzMDkzMg==&mid=2247485857&idx=1&sn=329edb0f980b3fdb8e1bb6efda631ba7&chksm=cf00c69af8774f8c8c73e8101aaef52bd8a27d7494aeece1927969ec9a8966b0c3e67d55cbfc&scene=178&cur_album_id=2150425279725469698#rd">vs code 调试网页 JS 代码</a></h3><p>配置<code>.vscode/launch.json</code>文件可在 vs code 中调试网页代码，并且还能查看性能分析。</p>
<p><strong>思考</strong></p>
<p>vs code 调试相比于浏览器调试的优势：一些写代码的惯性操作可以直接复用，如：代码搜索、折叠等操作，而不是在浏览器和编辑器之间频繁切换。</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="聊聊我遇到的那些贵人"><a href="#聊聊我遇到的那些贵人" class="headerlink" title="聊聊我遇到的那些贵人"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aGk7VmGBM5S2tDNuDGr87w">聊聊我遇到的那些贵人</a></h3><p>主动接近各种大佬，展现出自己的潜力。肯知识付费，这样能获得高质量的知识，算是一种高回报投资了。</p>
<h3 id="四句话总结我的学习观"><a href="#四句话总结我的学习观" class="headerlink" title="四句话总结我的学习观"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/whI_-E4b7iuVjVlZcfVnoQ">四句话总结我的学习观</a></h3><p>围绕工作学，才能使你对于这方面更加深入，而不是仅停留在 demo 级别。常用 debug。你学习了一些知识，如果没用到实践中的话，那就是没学会，如果不能给别人讲明白的话，那就是没学透彻。</p>
<h3 id="写文章注意"><a href="#写文章注意" class="headerlink" title="写文章注意"></a><a target="_blank" rel="noopener" href="https://github.com/king-hcj/king-hcj.github.io#%E7%BB%8F%E9%AA%8C%E4%B8%8E%E6%80%9D%E8%80%83">写文章注意</a></h3><p>经验与思考简约，尽量不展示多余内容。</p>
<p>有时一图抵千言，有时只会拖慢网页加载速度。</p>
<p>言之有物，不做无痛之呻吟。</p>
<p>杜绝难理解的长句子，如果不能将其拆分成几个简洁的短句，说明理解的并不清晰。</p>
<h3 id="多查官方标准文档"><a href="#多查官方标准文档" class="headerlink" title="多查官方标准文档"></a>多查官方标准文档</h3><p>多看好的文档，可以节约你的时间，如 MDN、<a target="_blank" rel="noopener" href="https://262.ecma-international.org/12.0/#sec-ecmascript-language-types-number-type">ECMAScript 2021 标准</a>，最近分享了浮点数相关知识，看标准给了我很大帮助。</p>
<p>还有 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/">whatwg html 规范</a>、<a target="_blank" rel="noopener" href="https://www.w3.org/Style/CSS/current-work.en.html">css 规范</a>（css规范比html难读一些），可参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Kq0inC2lrjrvAaP-0ltQoQ">大漠：我认识的 W3C 规范</a>。</p>
<p><em>2022-01-23 ~ 2022-02-27（第 7 期）</em></p>
<p>好歌推荐：<a target="_blank" rel="noopener" href="https://i.y.qq.com/v8/playsong.html?songid=335344888#webchat_redirect">踏雪 等什么君(邓寓君)</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/03/01/weekly/07/" data-id="cl5pg3mny002ebpor9q2h7edh" data-title="明远周刊：从零实现栅格地图" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-browser/extension" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/my-blog/2022/02/11/browser/extension/" class="article-date">
  <time class="dt-published" datetime="2022-02-11T11:33:29.000Z" itemprop="datePublished">2022-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/my-blog/2022/02/11/browser/extension/">写个浏览器插件吧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-02/11_11:40_BYHCz8.png" alt="image-20220211114010280"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文以实现一个简单的浏览器插件为例，带你入门插件开发。插件功能：一键复制标题以及链接，生成 Markdown 格式链接并给到剪切板。源代码在<a target="_blank" rel="noopener" href="https://github.com/acmu/my-extension">my-extension</a>仓库</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>近期在写周刊，要复制文章标题以及链接，之后转换为 Markdown 格式粘贴到文档编辑器中。</p>
<h2 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h2><p>每次都要重复「复制标题 ➡️ 复制链接 ➡️ 结合成 Markdown 」这些操作，文章一多就有些麻烦且枯燥。</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>要是能一键复制为 Markdown 链接格式（包含标题以及对应链接），接着直接到文档编辑器中粘贴，那该有多美好。🤩</p>
<p>刚好最近学了插件开发的内容，可以实现如上想法，正好借此机会实践一下（其实这里的插件应该叫扩展，也就是 extension ，但现在普遍都叫插件，故本文也使用此名称）。</p>
<h2 id="写插件"><a href="#写插件" class="headerlink" title="写插件"></a>写插件</h2><p>我常看的文章都是来自掘金与微信公众号，通过分析<code>HTML</code>代码发现，文章标题都是在<code>h1</code>标签内的，所以只要获取到<code>h1</code>标签的<code>innerText</code>内容再加上<code>window.location.href</code>即可完成目标。</p>
<p>首先新建目录<code>my-extension</code>，创建<code>manifest.json</code>文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;复制标题链接&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;使用 Markdown 格式复制标题链接&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需要一个简单的<code>manifest.json</code>文件，我们就已经编写了一个插件，这时在浏览器地址栏中输入<code>chrome://extensions</code>即可进入到插件管理页面，打开开发者模式并加载扩展：</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-02/04_08:02_EKQkFX.png" alt="image-20220204080203473"></p>
<p>加载完成后，可看到插件如下：</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-02/05_22:11_GnbMaK.png" alt="image-20220205221158858"></p>
<p>你可以理解为我们只是写了一个插件声明，但是这个插件什么都没有做，接下来我们给它添加功能，在<code>manifest.json</code>中增加<code>commands</code>字段、<code>permissions</code>字段和<code>background</code>字段，字段定义文档在<a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/mv3/manifest/">Manifest file format</a>中查看：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;activeTab&quot;</span>, <span class="string">&quot;scripting&quot;</span>],</span><br><span class="line"><span class="string">&quot;commands&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;run-copy&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;suggested_key&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;default&quot;</span>: <span class="string">&quot;Ctrl+Shift+Y&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;mac&quot;</span>: <span class="string">&quot;Command+Shift+Y&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;执行复制标题链接&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>commands</code>字段可以监听到快捷键的触发，上述代表使用<code>Command+Shift+Y</code>快捷键就能触发<code>run-copy</code>事件，这时新增<code>background.js</code>文件，并使用<code>chrome.commands.onCommand.addListener</code>即可添加事件监听器，但这里还需要获取当前 tab 以及注入脚本的权限，所以还需要<code>permissions</code>字段，最终<code>background.js</code>文件代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> copyTitleAndLink = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> fixedMessageId = <span class="string">&#x27;__fixed-message-id&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> tipStyle = <span class="string">`</span></span><br><span class="line"><span class="string">#__fixed-message-id &#123;</span></span><br><span class="line"><span class="string">    position: fixed;</span></span><br><span class="line"><span class="string">    right: 32px;</span></span><br><span class="line"><span class="string">    top: 32px;</span></span><br><span class="line"><span class="string">    background-color: white;</span></span><br><span class="line"><span class="string">    z-index: 9999;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    padding: 8px 16px;</span></span><br><span class="line"><span class="string">    min-width: 200px;</span></span><br><span class="line"><span class="string">    border-radius: 8px;</span></span><br><span class="line"><span class="string">    font-size: 12px;</span></span><br><span class="line"><span class="string">    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#__fixed-message-id.success &#123;</span></span><br><span class="line"><span class="string">    border: 2px solid #2ecc71;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#__fixed-message-id.fail &#123;</span></span><br><span class="line"><span class="string">    border: 2px solid #e74c3c;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">    <span class="comment">// 把提示信息插入到网页中</span></span><br><span class="line">    <span class="keyword">const</span> tipMessage = <span class="function"><span class="params">isOk</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> styleSheet = <span class="built_in">document</span>.createElement(<span class="string">&#x27;style&#x27;</span>);</span><br><span class="line">        styleSheet.innerText = tipStyle;</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild(styleSheet);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> div = <span class="built_in">document</span>.querySelector(<span class="string">`#<span class="subst">$&#123;fixedMessageId&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">if</span> (!div) &#123;</span><br><span class="line">            div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">            div.setAttribute(<span class="string">&#x27;id&#x27;</span>, fixedMessageId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isOk) &#123;</span><br><span class="line">            div.innerText = <span class="string">&#x27;复制成功 🎉&#x27;</span>;</span><br><span class="line">            div.setAttribute(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            div.innerText = <span class="string">&#x27;复制失败 😞&#x27;</span>;</span><br><span class="line">            div.setAttribute(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;fail&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">document</span>.body.append(div);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            div.remove();</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> h1Element = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;h1&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> title = h1Element.innerText;</span><br><span class="line">        <span class="comment">// 获取到需要的 Markdown 格式</span></span><br><span class="line">        <span class="keyword">const</span> titleAndLink = <span class="string">`[<span class="subst">$&#123;title&#125;</span>](<span class="subst">$&#123;<span class="built_in">window</span>.location.href&#125;</span>)`</span>;</span><br><span class="line">        <span class="comment">// 执行剪切板操作</span></span><br><span class="line">        <span class="comment">// 可参考 https://www.ruanyifeng.com/blog/2021/01/clipboard-api.html</span></span><br><span class="line">        <span class="keyword">await</span> navigator.clipboard.writeText(titleAndLink);</span><br><span class="line">        tipMessage(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&#x27;Failed to copy: &#x27;</span>, err);</span><br><span class="line">        tipMessage(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> runCopy = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 找到当前活跃的浏览器 tab 标签</span></span><br><span class="line">    <span class="keyword">let</span> [tab] = <span class="keyword">await</span> chrome.tabs.query(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给活跃的 tab 标签执行 copyTitleAndLink 函数</span></span><br><span class="line">    chrome.scripting.executeScript(&#123;</span><br><span class="line">        <span class="attr">target</span>: &#123; <span class="attr">tabId</span>: tab.id &#125;,</span><br><span class="line">        <span class="attr">function</span>: copyTitleAndLink,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">chrome.commands.onCommand.addListener(<span class="function"><span class="params">command</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (command === <span class="string">&#x27;run-copy&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 在监听到 run-copy command 时执行 runCopy 函数</span></span><br><span class="line">        runCopy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码先是监听了<code>run-copy</code>事件，之后找到当前活跃的 tab 页（也就是你正在浏览的 tab 页），接着执行了<code>copyTitleAndLink</code>函数，此函数的作用是在成功或者失败时在页面上给出提醒，如果按了快捷键后并没有效果，那么要到快捷键页面重新设置一下：</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-02/06_00:11_Q7ylZw.png" alt="image-20220206001112017"></p>
<p>在开发插件过程中，点击插件卡片上的<code>service worker</code>链接，即可打开<code>DevTools</code>调试<code>background.js</code>代码，如果产生错误，那么<code>Remove</code>按钮旁边有<code>Error</code>按钮，点击即可查看错误，直接打开活跃的 tab 页<code>DevTools</code>可调试注入进的 js 代码。</p>
<p>最后我们找<a target="_blank" rel="noopener" href="https://juejin.cn/post/7056417977675022366">一篇文章</a>测试一下，发现可以成功复制内容。🎉</p>
<p><img src="https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-02/06_00:30_Fh0Lob.png" alt="image-20220206003006212"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文简单介绍了<code>manifest.json</code>文件和一些插件 api，想了解更多内容可参考<a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/">开发文档</a>，想要从零入门可参考<a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/mv3/getstarted/">快速入门</a>。</p>
<p>实现一些功能简单的插件还是很容易的，为了提升你使用浏览器的效率，大家快去实践起来吧。😜</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://acmu.github.io/2022/02/11/browser/extension/" data-id="cl5pg3mnh001bbpor9t0b97et" data-title="写个浏览器插件吧" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/my-blog/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/my-blog/page/2/">2</a><a class="page-number" href="/my-blog/page/3/">3</a><a class="extend next" rel="next" href="/my-blog/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/TS/" rel="tag">TS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/%E5%88%B7%E9%A2%98/" rel="tag">刷题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/%E5%91%A8%E5%88%8A/" rel="tag">周刊</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/" rel="tag">效率工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/my-blog/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/my-blog/tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="/my-blog/tags/TS/" style="font-size: 10px;">TS</a> <a href="/my-blog/tags/%E5%88%B7%E9%A2%98/" style="font-size: 10px;">刷题</a> <a href="/my-blog/tags/%E5%91%A8%E5%88%8A/" style="font-size: 20px;">周刊</a> <a href="/my-blog/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 10px;">工程化</a> <a href="/my-blog/tags/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">效率工具</a> <a href="/my-blog/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 13.33px;">浏览器</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/my-blog/archives/2020/08/">八月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/my-blog/2022/07/17/JavaScript/js-promise/">JavaScript 异步与 Promise</a>
          </li>
        
          <li>
            <a href="/my-blog/2022/07/17/JavaScript/js-regexp/">JavaScript 正则理解</a>
          </li>
        
          <li>
            <a href="/my-blog/2022/07/17/JavaScript/symbol/">JavaScript Symbol 解读</a>
          </li>
        
          <li>
            <a href="/my-blog/2022/07/10/JavaScript/defineProperty/">defineProperty 详细解读</a>
          </li>
        
          <li>
            <a href="/my-blog/2022/07/05/tools/%E5%9C%A8%20mac%20%E4%B8%AD%E5%83%8F%20windows%20%E4%B8%80%E6%A0%B7%E5%88%87%E6%8D%A2%E5%BA%94%E7%94%A8/">在 Mac 中像 Windows 一样切换应用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 MingYuan<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/my-blog/" class="mobile-nav-link">Home</a>
  
    <a href="/my-blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/my-blog/js/jquery-3.4.1.min.js"></script>



  
<script src="/my-blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/my-blog/js/script.js"></script>





  </div>
</body>
</html>